<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8"/>
    <title>Администратор</title>

    <script>
        function check_inputs() {
            let name = document.getElementById("input-name");
            let login = document.getElementById("input-login");
            let password = document.getElementById("input-password");
            let roles = document.getElementById("input-roles");

            if ((name.value === "")||(login.value === "")||(password.value === "")||(roles.value === "")) {
                alert("Все поля должны быть заполнены!");
                return false;
            }

            let err = false;
            const validValues = ['user', 'admin'];
            roles.value.replace(/\s+/g, '').split(',').forEach(e => {
                if(!validValues.includes(e)) {
                    err = true;
                }
            })

            if(err){
                alert("Значениями поля 'Роли' могут быть " + validValues.map(r => "'"+r+"'").join(" или ") + ", разделенные запятыми!");
                return false;
            }

            return true;
        }
    </script>
</head>

<body>

<div style="width:700px; margin:0 auto;">
    <h4 style="text-align:center;">Все пользователи</h4>

    <form id="create-form" th:action="@{/user/save}" th:object="${newUser}" th:method="post" accept-charset="utf-8" onsubmit="return check_inputs()">

        <table style="margin:0 auto;" border="1">
            <thead bgcolor="lightGray">
            <tr height="45">
                <td style="width:75px; text-align:center">Id</td>
                <td style="width:200px; text-align:center">Имя</td>
                <td style="width:100px; text-align:center">Логин</td>
                <td style="width:100px; text-align:center">Пароль</td>
                <td style="width:150px; text-align:center">Роли</td>
            </tr>
            </thead>

            <tbody>
            <tr height="45">
                <td>
                    <!--        <div>-->
                    <!--                    <button style="box-sizing: border-box; width:100%; height:40px;" type="submit">Добавить</button>-->
                    <input style="box-sizing: border-box; width:100%; height:40px;" type="submit" value="Добавить"/>
                    <!--        </div>-->
                </td>
                <td>
                    <!--        <div>-->
                    <!--            <label for="input-name">Name:</label>-->
                    <input style="box-sizing: border-box; width:100%; height:40px;" type="text" id="input-name"
                           name="name" th:value="${newUser.name}" value="John Doe"/>
                </td>
                <td>
                    <!--            <label for="input-login">Login:</label>-->
                    <input style="box-sizing: border-box; width:100%; height:40px;" type="text" id="input-login"
                           name="login" th:value="${newUser.login}" value="sa"/>
                </td>
                <td>
                    <!--            <label for="input-password">Password:</label>-->
                    <input style="box-sizing: border-box; width:100%; height:40px;" type="text" id="input-password"
                           name="password" th:value="${newUser.password}" value="sa"/>
                </td>
                <td>
                    <!--            <label for="input-roles">Roles:</label>-->
                    <input style="box-sizing: border-box; width:100%; height:40px;" type="text" id="input-roles"
                           name="roles" th:value="${newUser.roles}" value="user"/>
                    <!--        </div>-->
                </td>
            </tr>


            <tr height="45" th:each="user : ${users}">
                <td>
                    <p th:text="${user.id}">1</p>
                </td>
                <td>
                    <p th:text="${user.name}">John Doe</p>
                </td>
                <td>
                    <p th:text="${user.login}">sa</p>
                </td>
                <td>
                    <p th:text="${user.password}">sa</p>
                </td>
                <td>
                    <p th:text="${user.getRolesAsString()}">user</p>
                </td>
            </tr>

            </tbody>
        </table>

    </form>
</div>
</body>
</html>